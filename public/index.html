<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>pres</title>
<style>

#input {
  padding: 15px;
  background: white;
  border-top: 1px solid #ddd;
}

.input-wrapper {
  display: flex;
  align-items: center;
  background: #f0f2f5;
  padding: 8px;
  border-radius: 30px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

#msg {
  flex: 1;
  border: none;
  background: transparent;
  padding: 10px 15px;
  font-size: 14px;
  outline: none;
}

#msg::placeholder {
  color: #888;
}

#msg:focus {
  outline: none;
}

.send-btn {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: none;
  cursor: pointer;
  font-size: 16px;
  color: white;
  background: linear-gradient(135deg, #1e88e5, #42a5f5);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

.send-btn:hover {
  transform: scale(1.1);
  box-shadow: 0 4px 10px rgba(30,136,229,0.4);
}

.send-btn:active {
  transform: scale(0.95);
}


  .online-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.2s;
}

.online-badge .dot {
  width: 10px;
  height: 10px;
  background-color: #4caf50; /* ÿ≥ÿ®ÿ≤ */
  border-radius: 50%;
  animation: pulse 1.2s infinite;
}

.admin-btn {
  display: none; /* ŸÅŸÇÿ∑ ÿ®ÿ±ÿß€å ÿßÿØŸÖ€åŸÜ ŸÜŸÖÿß€åÿ¥ ÿØÿßÿØŸá ŸÖ€åÿ¥Ÿá */
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  border: none;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  color: white;
  background: linear-gradient(135deg, #d32f2f, #f44336);
  box-shadow: 0 4px 10px rgba(211,47,47,0.3);
  transition: all 0.25s ease;
}

.admin-btn:hover {
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 6px 14px rgba(211,47,47,0.4);
}

.admin-btn:active {
  transform: scale(0.95);
}

.admin-icon {
  font-size: 14px;
  transition: transform 0.3s ease;
}

.admin-btn:hover .admin-icon {
  transform: rotate(30deg);
}

.online-badge:hover {
  animation: shake 0.3s;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.3); opacity: 0.7; }
}

@keyframes shake {
  0% { transform: translateX(0); }
  25% { transform: translateX(-2px); }
  50% { transform: translateX(2px); }
  75% { transform: translateX(-2px); }
  100% { transform: translateX(0); }
}

#users {
  padding: 15px;
  background: #fafafa;
}

#userList {
  list-style: none;
  padding: 0;
  margin: 0;
}

.user-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.user-item:hover {
  background: #f0f2f5;
  transform: translateX(3px);
}

/* ÿ¢Ÿàÿßÿ™ÿßÿ± ŸÖÿ™ŸÜ€å */
.avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: linear-gradient(135deg, #1e88e5, #42a5f5);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 600;
  font-size: 16px;
}

/* ÿßÿ∑ŸÑÿßÿπÿßÿ™ ⁄©ÿßÿ±ÿ®ÿ± */
.user-info {
  display: flex;
  flex-direction: column;
}

.username {
  font-weight: 600;
  font-size: 14px;
}

.status {
  font-size: 12px;
  color: #4caf50;
}

.deleteBtn {
  float: right;
  cursor: pointer;
  margin-left: 10px;
  opacity: 0.6;
  transition: 0.2s;
}

.deleteBtn:hover {
  opacity: 1;
  transform: scale(1.2);
}


body { margin:0; font-family:sans-serif; display:flex; height:100vh; }
#users { width:25%; border-right:1px solid #ddd; padding:10px; }
#chat { flex:1; display:flex; flex-direction:column; }
#header { display:flex; justify-content:space-between; align-items:center; padding:10px 15px; border-bottom:1px solid #ddd; }
#messages { flex:1; overflow-y:auto; padding:15px; display:flex; flex-direction:column; gap:10px; background:#f0f2f5; }
.message { display:flex; }
.my-message { justify-content:flex-end; }
.other-message { justify-content:flex-start; }
.bubble { max-width:60%; padding:10px 14px; border-radius:18px; font-size:14px; line-height:1.4; }
.my-message .bubble { background-color:#dcf8c6; border-bottom-right-radius:5px; }
.other-message .bubble { background-color:white; border-bottom-left-radius:5px; border:1px solid #ddd; }
#marketBox { font-size:14px; background:#f5f5f5; padding:6px 10px; border-radius:8px; }
#logo { display:flex; align-items:center; gap:8px; font-size:26px; font-weight:700; color:#1e88e5; }
#logo .icon { font-size:30px; }
#adminBtn { background:red; color:white; display:none; }
#adminPanel { display:none; position:absolute; top:50px; right:20px; background:#f5f5f5; border:1px solid #ccc; padding:10px; }
</style>
</head>
<body>

<div id="header">
  <div id="logo"><span class="icon">üí¨</span> pres</div>
  <div id="marketBox">BTC: <span id="btcPrice">--</span></div>
  <button id="adminBtn" class="admin-btn">
  <span class="admin-icon">‚öô</span>
  Admin Panel
</button>

</div>

<div class="online-badge">
  <span class="dot"></span>
  Online
</div>


<div id="users">
  <h3>Online</h3>
  <ul id="userList"></ul>
</div>

<div id="chat">
  <div id="messages"></div>
  <div id="input">
  <div class="input-wrapper">
    <input id="msg" placeholder="Type your message..." />
    <button class="send-btn" onclick="send()">
      ‚û§
    </button>
  </div>
</div>

</div>

<div id="adminPanel">
<h3>Admin Panel</h3>
<input id="kickUser" placeholder="Username to kick" />
<button onclick="kick()">Kick</button><br/>

<input id="muteUser" placeholder="Username to mute" />
<input id="muteMinutes" placeholder="Minutes" type="number"/>
<button onclick="mute()">Mute</button><br/>

<input id="broadcastMsg" placeholder="Broadcast message"/>
<button onclick="broadcast()">Send</button><br/>

<input id="newAdminPass" placeholder="New Admin Password"/>
<input id="newPublicPass" placeholder="New Public Password"/>
<button onclick="changePasswords()">Change Passwords</button><br/>

<h4>Change Background Color</h4>
<button onclick="changeBg('white')">White</button>
<button onclick="changeBg('lightblue')">Blue</button>
<button onclick="changeBg('lightgreen')">Green</button>

<h4>Change Chat Background</h4>
<button onclick="changeChatColor('lightgreen')">Green</button>
<button onclick="changeChatColor('lightblue')">Blue</button>

<button onclick="showIPs()">Show User IPs</button>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const username = prompt('username');
const password = prompt('password');

socket.emit('login', { username, password });

socket.on('loginSuccess', data => {
  if (data.role === 'admin') document.getElementById('adminBtn').style.display='block';
});

socket.on('loginError', () => alert('Login failed'));

socket.on('users', users => {
  const list = document.getElementById('userList');
  list.innerHTML = '';

  users.forEach(user => {
    const li = document.createElement('li');
    li.classList.add('user-item');

    const firstLetter = user.charAt(0).toUpperCase();

    li.innerHTML = `
      <div class="avatar">${firstLetter}</div>
      <div class="user-info">
        <span class="username">${user}</span>
        <span class="status">online</span>
      </div>
    `;

    list.appendChild(li);
  });
});


socket.on("newMessage", (data) => {

  const messageDiv = document.createElement("div");
  messageDiv.classList.add("message");
  messageDiv.setAttribute("data-id", data.id);

  if (data.userId === socket.id) {
    messageDiv.classList.add("my-message");
  } else {
    messageDiv.classList.add("other-message");
  }

  messageDiv.innerHTML = `
    <div class="bubble">
      <strong>${data.username}</strong>
      ${data.userId === socket.id ? `<span class="deleteBtn" onclick="deleteMsg('${data.id}')">üóë</span>` : ""}
      <br/>
      ${data.text}
    </div>
  `;

  document.getElementById("messages").appendChild(messageDiv);
  document.getElementById("messages").scrollTop =
    document.getElementById("messages").scrollHeight;
});


socket.on('changeChatColor', color => document.getElementById('chat').style.backgroundColor = color);

socket.on('marketData', data => { document.getElementById('btcPrice').innerText = data.btc; });

function send() {
  if (!username) return alert("Login first");
  socket.emit('chat', document.getElementById('msg').value);
  document.getElementById('msg').value='';
}

document.getElementById('adminBtn').onclick = () => {
  const panel = document.getElementById('adminPanel');
  panel.style.display = panel.style.display==='none'?'block':'none';
}

function kick() {
  const user = document.getElementById('kickUser').value.trim();
  if (!user) return alert("Enter a username");
  socket.emit('adminAction', { type:'kick', user });
}

function mute() {
  const user = document.getElementById('muteUser').value.trim();
  const minutes = parseInt(document.getElementById('muteMinutes').value)||1;
  socket.emit('adminAction', { type:'mute', user, minutes });
}

function broadcast() {
  const msg = document.getElementById('broadcastMsg').value;
  socket.emit('adminAction', { type:'broadcast', msg });
}

function changePasswords() {
  const newAdmin = document.getElementById('newAdminPass').value;
  const newPublic = document.getElementById('newPublicPass').value;
  socket.emit('adminAction', { type:'changePasswords', newAdmin, newPublic });
}

function changeBg(color) { document.getElementById('adminPanel').style.backgroundColor = color; }
function changeChatColor(color) { socket.emit('adminAction', { type:'changeChatColor', color }); }
function showIPs() { socket.emit('adminAction', { type:'getIPs' }); }

socket.on('userIPs', ips => alert(ips.map(u=>`${u.username}: ${u.ip}`).join("\n")));

document.getElementById("msg").addEventListener("keydown", function(e) {
  if (e.key === "Enter") {
    send();
  }
});

function deleteMsg(id) {
  socket.emit("deleteMessage", id);
}

socket.on("messageDeleted", (id) => {
  const msg = document.querySelector(`[data-id="${id}"]`);
  if (msg) msg.remove();
});


</script>
</body>
</html>
