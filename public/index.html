<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>pres</title>
  <style>
    body { margin:0; font-family: sans-serif; display:flex; height:100vh; }
    #users { width:25%; border-right:1px solid #ddd; padding:10px; }
    #chat { flex:1; display:flex; flex-direction:column; }
    #header { display:flex; justify-content:space-between; align-items:center; padding:10px 15px; border-bottom:1px solid #ddd; }
    #messages { flex:1; overflow-y:auto; padding:15px; display:flex; flex-direction:column; gap:10px; background:#f0f2f5; }
    #input { display:flex; padding:10px; border-top:1px solid #ddd; }
    #input input { flex:1; padding:8px; font-size:14px; }
    #input button { padding:8px 12px; margin-left:5px; }

    #adminBtn { background:red; color:white; display:none; padding:6px 12px; border:none; border-radius:4px; cursor:pointer; }
    #logo { display:flex; align-items:center; gap:8px; font-size:26px; font-weight:700; color:#1e88e5; }
    #logo .icon { font-size:30px; }
    #marketBox { font-size:14px; background:#f5f5f5; padding:6px 10px; border-radius:8px; }

    .message { display:flex; }
    .my-message { justify-content:flex-end; }
    .other-message { justify-content:flex-start; }
    .bubble { max-width:60%; padding:10px 14px; border-radius:18px; font-size:14px; line-height:1.4; }
    .my-message .bubble { background-color:#dcf8c6; border-bottom-right-radius:5px; }
    .other-message .bubble { background-color:white; border:1px solid #ddd; border-bottom-left-radius:5px; }

    #adminPanel { display:none; position:absolute; top:50px; right:20px; background:#f5f5f5; border:1px solid #ccc; padding:10px; border-radius:6px; z-index:100; width:220px; }
    #adminPanel input { width:100%; margin-bottom:5px; padding:4px; font-size:12px; }
    #adminPanel button { width:100%; margin-bottom:5px; padding:6px; font-size:12px; }
    #adminPanel h4 { margin:10px 0 5px 0; font-size:13px; }
  </style>
</head>
<body>

  <!-- HEADER -->
  <div id="header">
    <div id="logo"><span class="icon">ðŸ’¬</span> pres</div>
    <div id="marketBox">Gold: <span id="goldPrice">--</span> | BTC: <span id="btcPrice">--</span></div>
    <button id="adminBtn">Admin</button>
  </div>

  <!-- USERS -->
  <div id="users">
    <h3>Online</h3>
    <ul id="userList"></ul>
  </div>

  <!-- CHAT -->
  <div id="chat">
    <div id="messages"></div>
    <div id="input">
      <input id="msg" placeholder="message" />
      <button onclick="send()">Send</button>
    </div>
  </div>

  <!-- ADMIN PANEL -->
  <div id="adminPanel">
    <h3>Admin Panel</h3>
    <input id="kickUser" placeholder="Username to kick" />
    <button onclick="kick()">Kick</button>

    <input id="muteUser" placeholder="Username to mute" />
    <input id="muteMinutes" placeholder="Minutes" type="number"/>
    <button onclick="mute()">Mute</button>

    <input id="broadcastMsg" placeholder="Broadcast message"/>
    <button onclick="broadcast()">Send</button>

    <input id="newAdminPass" placeholder="New Admin Password"/>
    <input id="newPublicPass" placeholder="New Public Password"/>
    <button onclick="changePasswords()">Change Passwords</button>

    <h4>Change Admin Panel Background</h4>
    <button onclick="changeBg('white')">White</button>
    <button onclick="changeBg('lightblue')">Blue</button>
    <button onclick="changeBg('lightgreen')">Green</button>

    <h4>Change Chat Background</h4>
    <button onclick="changeChatColor('lightgreen')">Green</button>
    <button onclick="changeChatColor('lightblue')">Blue</button>
    <button onclick="showIPs()">Show User IPs</button>

  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const username = prompt('username');
    const password = prompt('password');

    socket.emit('login', { username, password });

    socket.on('loginSuccess', (data) => {
      if(data.role === 'admin') document.getElementById('adminBtn').style.display = 'block';
    });

    socket.on('loginError', () => alert('Login failed'));

    socket.on('users', users => {
      document.getElementById('userList').innerHTML = users.map(u => `<li>${u}</li>`).join('');
    });

    socket.on('chat', data => {
      const messageDiv = document.createElement('div');
      messageDiv.classList.add('message');
      messageDiv.classList.add(data.user === username ? 'my-message' : 'other-message');

      messageDiv.innerHTML = `<div class="bubble"><strong>${data.user}</strong><br/>${data.msg}</div>`;
      document.getElementById('messages').appendChild(messageDiv);
      document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
    });

socket.on('userIPs', ips => {
  console.log("Users and IPs:", ips);
  alert(ips.map(u => `${u.username}: ${u.ip}`).join("\n"));
});


    socket.on('changeChatColor', (color) => {
      document.getElementById('chat').style.backgroundColor = color;
    });

    socket.on('marketData', data => {
      document.getElementById('goldPrice').innerText = data.gold;
      document.getElementById('btcPrice').innerText = data.btc;
    });

    function send() {
      socket.emit('chat', document.getElementById('msg').value);
      document.getElementById('msg').value = '';
    }

    document.getElementById('adminBtn').onclick = () => {
      const panel = document.getElementById('adminPanel');
      panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
    }

    function kick() {
  const user = document.getElementById('kickUser').value.trim();
  if (!user) return alert("Enter a username to kick");
  socket.emit('adminAction', { type:'kick', user });
}

    function mute() { socket.emit('adminAction', { type:'mute', user: document.getElementById('muteUser').value, minutes: parseInt(document.getElementById('muteMinutes').value)||1 }); }
    function broadcast() { socket.emit('adminAction', { type:'broadcast', msg: document.getElementById('broadcastMsg').value }); }
    function changePasswords() { socket.emit('adminAction', { type:'changePasswords', newAdmin: document.getElementById('newAdminPass').value, newPublic: document.getElementById('newPublicPass').value }); }
    function changeBg(color) { document.getElementById('adminPanel').style.backgroundColor = color; }
    function changeChatColor(color) { socket.emit('adminAction', { type:'changeChatColor', color }); }
    function showIPs() {
  socket.emit('adminAction', { type: 'getIPs' });
}

  </script>
</body>
</html>
